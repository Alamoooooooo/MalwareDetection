
# -*- coding: utf-8 -*-

'''
import numpy, os, array
import imageio

filename = 'D:/AlamoWork/Adware/test.apk'
graphname = 'D:/AlamoWork/Adware/test1.jpg'
 
f = open(filename,'rb') # 读入文件
ln = os.path.getsize(filename) # 文件长度（byte）
width = 512 # 固定图片宽度
rem = ln%width # 计算余出的字节 
a = array.array("B") # uint8 数组
a.fromfile(f,ln-rem) # 将文件读入数组a中，舍去余出的字节
f.close()    
g = numpy.reshape(a,(len(a)//width,width)) # 将数组转为二维
g = numpy.uint8(g)
imageio.imsave(graphname,g) # 保存图片
'''


import numpy, os, array
import imageio
import math
# 列出当前目录下所有的文件
#files = os.listdir('D:/AlamoWork/Adware/mytestzip/')

path ='F:/1_Final/Benign/Benign_2017/Benign_2017'

def get_filelist(dir):
    Filelist = []
    for root, dirs, files in os.walk(path):
        for filename in files:
            # 文件名列表，包含完整路径
            Filelist.append(os.path.join(root, filename))
        return Filelist

def toimg(files):
    for filename in files:
        #portion = os.path.splitext(filename)
	# 如果后缀是.dex
        #if portion[1] == ".dex": 
        if '.dex' in filename: 
    		#设定生成图片名	
            graphname = filename+'.jpg'
            filename1 = filename
            print(graphname,filename)
            
            f = open(filename1,'rb') # 读入文件
            ln = os.path.getsize(filename1) # 文件长度（byte）
            
            length = int(math.sqrt(ln))
            width = length # 生成正方形
            #a = array.array("B") # uint8 数组
            #bt = numpy.zeros((length*width)) #建立数组并填充0
            #a = numpy.array(bt,dtype='uint8') 
            a = array.array("B")
            
            print(length,width)
            print(length*width)
            
            #rem = ln % length # 计算余出的字节 
            rem = ln - (length*width) # 计算余出的字节 
            a.fromfile(f,ln-rem) # 将文件读入数组a中，舍去余出的字节
            f.close()
            
            #while( < length*width):
            #    a.append(0)
            
            g = numpy.reshape(a,(length,width)) # 将数组转为二维
            g = numpy.uint8(g)
            imageio.imsave(graphname,g) # 保存图片


 
Filelist = get_filelist(path)
 
#print(len( Filelist))
 
toimg(Filelist)