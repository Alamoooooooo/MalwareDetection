# -*- coding: utf-8 -*-

#灰色图转成彩色图，并将其黑色的变成绿色的水系
import os
#import cv2
from PIL import Image
import numpy as np


import numpy, array
import imageio
import math


filename = 'D:\\AlamoWork\\Adware\\test good\\classes.dex'
graphname = 'D:/AlamoWork/Adware/test/goodclass.jpg'
'''
filename = 'D:\\AlamoWork\\Adware\\Adware\\Adware\\ewind\\1de012d8de8b0be0d0b27da1a0c03f52.apk'
#filename = 'D:/AlamoWork/Adware/test/air.beingfashiondesigner/classes.dex'
#graphname = 'D:/AlamoWork/Adware/test/goodtestjpg.jpg'
graphname = 'D:/AlamoWork/Adware/test/ewind222.jpg'
'''
f = open(filename,'rb') # 读入文件
ln = os.path.getsize(filename) # 文件长度（byte）

length = int(math.sqrt(ln))
width = length # 生成正方形
#a = array.array("B") # uint8 数组
#bt = numpy.zeros((length*width)) #建立数组并填充0
#a = numpy.array(bt,dtype='uint8') 
a = array.array("B")

print(length,width)
print(length*width)

#rem = ln % length # 计算余出的字节 
rem = ln - (length*width) # 计算余出的字节 
a.fromfile(f,ln-rem) # 将文件读入数组a中，舍去余出的字节
f.close()

#while( < length*width):
#    a.append(0)

g = numpy.reshape(a,(length,width)) # 将数组转为二维
g = numpy.uint8(g)
imge = imageio.imsave(graphname,g) # 保存图片


#img = Image.open("C:/Users/Administrator/Desktop/laos2018_713725.png")
img = Image.open(graphname)

img_rgb = img.convert("RGB")
img_array = np.array(img_rgb)
#img_rgb.save("C:/Users/Administrator/Desktop/rgb.png")
#print(img_array)
#print(np.unique(img_array))
print(img_array.shape)
print(img_array[100, 0])
w = img.size[0]
h = img.size[1]
img2_array = []
for i in range(0, h):
    for j in range(0, w):
        if img_array[i][j][0] == 0 and img_array[i][j][1] == 0 and img_array[i][j][1] == 0:
            img_array[i, j] = [0, 250, 0]
            img2_array.append(img_array[i, j])
        else:
            img2_array.append(img_array[i, j])
img2_array = np.array(img2_array)
print(img2_array.shape)
#img2_array = img2_array.reshape(3136, 3333, 3)
img2_array = img2_array.reshape(length, width, 3)
 
img3 = Image.fromarray(img2_array)
img3.save('D:/AlamoWork/Adware/test/gdgdgd.jpg')
