# -*- coding: utf-8 -*-

import zipfile
import tarfile
#import rarfile
from glob import glob
import os
import sys

import numpy, array
import imageio
import math


'''       
Pos_zip='D:\\AlamoWork\\Adware\\mytestzip'
Pos_unzip='D:\\AlamoWork\\Adware\\mytestunzip'
Type='zip'
'''
Pos_zip=sys.argv[1]
Pos_unzip=sys.argv[2]
Type=sys.argv[3]

files = glob(Pos_zip)

'''
# 列出当前目录下所有的文件
files2 = os.listdir(Pos_zip)
print('files',files2)
for filename in files2:
    portion = os.path.splitext(filename)
	# 如果后缀是.apk
    if portion[1] == ".apk":  
		# 重新组合文件名和后缀名
        newname = portion[0] + ".zip" 
        print(newname)
        os.rename(filename,newname)
'''     

def toimg(filename):
    graphname = filename + '.jpg'

    f = open(filename,'rb') # 读入文件
    ln = os.path.getsize(filename) # 文件长度（byte）
    
    length = int(math.sqrt(ln))
    width = length # 生成正方形
    #a = array.array("B") # uint8 数组
    #bt = numpy.zeros((length*width)) #建立数组并填充0
    #a = numpy.array(bt,dtype='uint8') 
    a = array.array("B")
    
    #print(length,width)
    #print(length*width)
    
    #rem = ln % length # 计算余出的字节 
    rem = ln - (length*width) # 计算余出的字节 
    a.fromfile(f,ln-rem) # 将文件读入数组a中，舍去余出的字节
    f.close()
    
    #while( < length*width):
    #    a.append(0)
    
    g = numpy.reshape(a,(length,width)) # 将数组转为二维
    g = numpy.uint8(g)
    imageio.imsave(graphname,g) # 保存图片




def un_zip(filename):

    zip_file = zipfile.ZipFile(filename)
    a_name=zip_file.namelist()
    if (filename.find(".zip")) > -1:
        zip_file = zipfile.ZipFile(filename)
        a_name=zip_file.namelist()
    if (filename.find(".tar")) > -1:
        zip_file = tarfile.open(filename)
        a_name=zip_file.getnames()
    #if (filename.find(".rar")) > -1:
        #zip_file = rarfile.RarFile(filename)
        #a_name=zip_file.namelist()
    i = 1
    for names in a_name:
        if (names.find(Type)) > -1:	
            try:
                zip_file.extract(names, Pos_unzip+str(i))
                i = i+1
            except:
                print(filename+"解压失败！")
                pass
    print (filename+"解压完成！")

for file_name in files:
    un_zip(file_name)
